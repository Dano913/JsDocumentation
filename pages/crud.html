<section class="section" id="dom">
    <h1>CRUD</h1>
    <div class="intro-text">
        <h2>Crear, modificar, recuperar y eliminar mediante DOM</h2>
        <p>Vamos a ver un ejemplo de práctica de DOM usando lógica de JavaScript.</p>
        <p>En esta práctica haremos un pequeño ToDoList (lista de tareas pendientes).</p>
        <p>En esta aplicación tendremos una serie de tareas y las iremos pintando ordenadas en el HTML (queremos que primero salgan las tareas pendientes y al final las completadas) mediante JavaScript, a continuación jugaremos un poco con CSS para diferenciar las completadas de las no completadas y mediante javascript haremos una funcionalidad para cambiar esa propiedad y repintar el resultado de nuevo en el DOM.</p>
    </div>
    <div class="intro-text">
        <h2>Paso 1 - Creación de archivos</h2>
        <p>En este caso va a ser una práctica muy sencilla y vamos a crear un HTML, un JS y un CSS.</p>
    </div>
    <div class="intro-text">
        <h2>Paso 2 - Crear la estructura inicial del HTML y enlazar el CSS y el JS</h2>
        <p>En este caso lo único que vamos a crear en el HTML es un ul con la clase list, que usaremos como contenedor para introducir todas las tareas y un div con un input y un botón para añadir nuevas tareas.</p>
        <pre><code class="language-javascript">
            &lt;!DOCTYPE html&gt;
            &lt;html lang="en"&gt;
                &lt;head&gt;
                    &lt;meta charset="UTF-8"&gt;
                    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
                    &lt;title&gt;To do list&lt;/title&gt;
                    &lt;script src="index.js" defer&gt;&lt;/script&gt;
                    &lt;link rel="stylesheet" href="style.css"&gt;
                &lt;/head&gt;
                &lt;body&gt;
                    &lt;ul class="list"&gt;&lt;/ul&gt;
                    &lt;div class="new"&gt;
                        &lt;input placeholder="escribe una nueva tarea"&gt;
                        &lt;button&gt;Añadir tarea&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/body&gt;
            &lt;/html&gt;
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 3 - Estilos</h2>
        <p>Como veis, vamos a dar unos estilos un poco generales y a declarar 3 variables de colores, en este caso no es un proyecto muy grande y extenso y por lo tanto no nos hará falta mucho más, ya que lo importante estará en nuestro js, además estamos modificando la barra de scroll.</p>
        <p>El término “rtc” simula el nombre de una compañía o marca, por ejemplo, puede que en la NASA las variables del color se llamen —nasa-color-primary.</p>
        <p>Fijaos además que estamos utilizando la clase completed para tareas ya completadas:</p>
        <pre><code class="language-javascript">
            :root {
            --rtc-color-1: rgb(255, 255, 255);
            --rtc-color-2: rgb(207, 207, 207);
            --rtc-color-3: rgb(0, 0, 0);
            }

            * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            }

            ul,
            ol {
            list-style: none;
            }

            a {
            text-decoration: none;
            }

            body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100svh;
            }

            /* SCROLLBAR */
            /* width */
            ::-webkit-scrollbar {
            width: 3px;
            }

            /* Track */
            ::-webkit-scrollbar-track {
            background: var(--rtc-color-1);
            }

            /* Handle */
            ::-webkit-scrollbar-thumb {
            background: var(--rtc-color-3);
            }

            .list {
            width: 50%;
            max-height: 50svh;
            overflow-y: scroll;
            border-radius: 20px 0px 0px 20px;
            border: 3px solid black;
            }

            .list > li {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            font-size: 30px;
            cursor: pointer;
            user-select: none;
            border-bottom: 3px solid black;
            }

            .list > li:last-child {
            border-bottom: none;
            }

            .list > li.completed {
            background-color: var(--rtc-color-2);
            text-decoration: line-through;
            }

            .new {
                display: flex;
                padding: 40px;
                font-size: 30px;
                gap: 20px;
            }

            .new > input, .new > button {
                padding: 20px 30px;
                border-radius: 20px;
                border: 3px solid black;
            }

            .new > button {
                cursor: pointer;
            }
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 4 - Crear los datos en JavaScript</h2>
        <p>Tenemos que tener los datos en un inicio y podemos elegir la estructura que decidamos, pero en este caso hemos optado por esta estructura bastante simple, cada tarea tiene dos propiedades: la descripción de la tarea y el dato booleano que nos dice si está completada o no.</p>
        <pre><code class="language-javascript">
            const tasks = [
                {
                    description: "Ir a hacer la compra",
                    completed: false
                },
                {
                    description: "Crear el archivo html",
                    completed: true
                },
                {
                    description: "Arreglar el coche",
                    completed: false
                },
                {
                    description: "Crear proyecto millonario",
                    completed: false
                },
                {
                    description: "Enlazar el archivo js al HTML",
                    completed: true
                },
                {
                    description: "Ir al gimnasio",
                    completed: true
                },
                {
                    description: "Tejer una camiseta",
                    completed: false
                },
                {
                    description: "Ir a comprar agua",
                    completed: false
                },
                {
                    description: "Fregar los platos",
                    completed: true
                }
            ];
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 5 - Pintar las tareas en el HTML</h2>
        <p>Creamos una función para pintar tareas:</p>
        <pre><code class="language-javascript">
            // función pintar tareas a la que le llega un array de tareas al cual nombramos como tasksToPrint
            const printTasks = (tasksToPrint) => {
                // recogemos el contenedor donde queremos introducir cada tarea
                const ul = document.querySelector(".list");
                // limpiamos el contenedor con innerHTML vacío por si tuviera alguna tarea pintada previamente como puede pasar en el futuro
                ul.innerHTML = "";

                // recorremos el array de tareas que nos ha llegado a nuestra función
                for (let i = 0; i < tasksToPrint.length; i++) {
                    // guardamos cada tarea en la variable task recién creada
                    const task = tasksToPrint[i];

                    // creamos nuestra tarea, será un "li"
                    const li = document.createElement("li");

                    // añadimos el contenido de texto al li que será la descripción de la tarea
                    li.textContent = task.description;

                    // añadimos el evento click a la lista, que llamará a una función completar a la que le enviaremos la posición de la tarea a la que le hemos hecho click, esta función la veremos creada más adelante
                    li.addEventListener("click", () => complete(i));

                    // si la tarea estuviese completada... le añadiríamos la clase "completed", en caso contrario no añadimos ninguna clase
                    if (task.completed === true) {
                        li.className = "completed";
                    }

                    // añadimos la tarea a la lista de tareas
                    ul.appendChild(li);
                }
            }
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 6 - Ordenar las tareas</h2>
        <p>Creamos una función para pintar tareas:</p>
        <pre><code class="language-javascript">
            // función pintar tareas a la que le llega un array de tareas al cual nombramos como tasksToPrint
            const printTasks = (tasksToPrint) => {
                // recogemos el contenedor donde queremos introducir cada tarea
                const ul = document.querySelector(".list");
                // limpiamos el contenedor con innerHTML vacío por si tuviera alguna tarea pintada previamente como puede pasar en el futuro
                ul.innerHTML = "";

                // recorremos el array de tareas que nos ha llegado a nuestra función
                for (let i = 0; i < tasksToPrint.length; i++) {
                    // guardamos cada tarea en la variable task recién creada
                    const task = tasksToPrint[i];

                    // creamos nuestra tarea, será un "li"
                    const li = document.createElement("li");

                    // añadimos el contenido de texto al li que será la descripción de la tarea
                    li.textContent = task.description;

                    // añadimos el evento click a la lista, que llamará a una función completar a la que le enviaremos la posición de la tarea a la que le hemos hecho click, esta función la veremos creada más adelante
                    li.addEventListener("click", () => complete(i));

                    // si la tarea estuviese completada... le añadiríamos la clase "completed", en caso contrario no añadimos ninguna clase
                    if (task.completed === true) {
                        li.className = "completed";
                    }

                    // añadimos la tarea a la lista de tareas
                    ul.appendChild(li);
                }
            }
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 7 - Completar una tarea</h2>
        <p>Para completar una tarea en la función pintar tendremos una línea de código que nos controlará cuando el usuario haga click en una tarea y nos traerá a esta función, la cual vemos explicada a continuación.</p>
        <p>Con esta función completamos el primer ciclo de comportamiento de una tarea cuando el usuario las completa.</p>
        <pre><code class="language-javascript">
            // función completar tareas a la que le llega la posición de la tarea a la que el usuario le ha hecho click
            const complete = (i) => {
                // accedemos a esa posición en el array de tareas y le cambiamos la propiedad completed a true
                tasks[i].completed = true;
                // ordenamos de nuevo las tareas, que esta función a su vez las pintará de nuevo ordenadas
                orderTasks(tasks);
            }
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 8 - Añadir una nueva tarea</h2>
        <p>Para añadir una nueva tarea, vamos a recoger el botón de añadir tarea, para controlar cuando hacen click en el botón y llamar a la función addTask, la cual veremos creada a continuación</p>
        <pre><code class="language-javascript">
            const button = document.querySelector(".new > button");

            button.addEventListener("click", addTask);
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Paso 9 - Función addTask</h2>
        <pre><code class="language-javascript">
            // función añadir tarea, la cual se ejecuta cuando el usuario hace click en el botón
            const addTask = () => {
                // recogemos el input, puesto que queremos el valor que el usuario haya introducido en el
                const input = document.querySelector(".new > input");
                // creamos la estructura que tienen TODAS nuestras tareas, ya que deberá ser igual, por defecto la creamos NO completada
                const newTask = {
                    description: input.value, // input.value es el valor del input que ha escrito el usuario, el cual usamos en la propiedad description
                    completed: false
                };
                // añadimos la nueva tarea al principio de nuestro array con el método unshift
                tasks.unshift(newTask);
                // limpiamos el input
                input.value = "";
                // llamamos de nuevo a la función pintar para que nos pinte todas las tareas de nuevo ya que hemos añadida una nueva
                printTasks(tasks);
            }
        </code></pre>
    </div>
    <div class="intro-text">
        <h2>Revisión de nuestro JS</h2>
        <p>Es importante ver como ordenamos estos bloques de código que hemos creado, así que os dejamos por aquí todo el código JS completo para que podáis revisarlo:</p>
        <pre><code class="language-javascript">
            // creación de los datos iniciales
            const tasks = [
                {
                    description: "Ir a hacer la compra",
                    completed: false
                },
                {
                    description: "Crear el archivo html",
                    completed: true
                },
                {
                    description: "Arreglar el coche",
                    completed: false
                },
                {
                    description: "Crear proyecto millonario",
                    completed: false
                },
                {
                    description: "Enlazar el archivo js al HTML",
                    completed: true
                },
                {
                    description: "Ir al gimnasio",
                    completed: true
                },
                {
                    description: "Tejer una camiseta",
                    completed: false
                },
                {
                    description: "Ir a comprar agua",
                    completed: false
                },
                {
                    description: "Fregar los platos",
                    completed: true
                }
            ];

            // función completar tareas a la que le llega la posición de la tarea a la que el usuario le ha hecho click
            const complete = (i) => {
                // accedemos a esa posición en el array de tareas y le cambiamos la propiedad completed a true
                tasks[i].completed = true;
                // ordenamos de nuevo las tareas, que esta función a su vez las pintará de nuevo ordenadas
                orderTasks(tasks);
            }

            // función pintar tareas a la que le llega un array de tareas al cual nombramos como tasksToPrint
            const printTasks = (tasksToPrint) => {
                // recogemos el contenedor donde queremos introducir cada tarea
                const ul = document.querySelector(".list");
                // limpiamos el contenedor con innerHTML vacío por si tuviera alguna tarea pintada previamente como puede pasar en el futuro
                ul.innerHTML = "";

                // recorremos el array de tareas que nos ha llegado a nuestra función
                for (let i = 0; i < tasksToPrint.length; i++) {
                    // guardamos cada tarea en la variable task recién creada
                    const task = tasksToPrint[i];

                    // creamos nuestra tarea, será un "li"
                    const li = document.createElement("li");

                    // añadimos el contenido de texto al li que será la descripción de la tarea
                    li.textContent = task.description;

                    // añadimos el evento click a la lista, que llamará a una función completar a la que le enviaremos la posición de la tarea a la que le hemos hecho click, esta función la veremos creada más adelante
                    li.addEventListener("click", () => complete(i));

                    // si la tarea estuviese completada... le añadiríamos la clase "completed", en caso contrario no añadimos ninguna clase
                    if (task.completed === true) {
                        li.className = "completed";
                    }

                    // añadimos la tarea a la lista de tareas
                    ul.appendChild(li);
                }
            }

            // función ordenar tareas a la que le llega un array de tareas al cual nombramos como tasksToOrder
            const orderTasks = (tasksToOrder) => {
                // utilizamos el método de arrays sort para ordenar, a y b representarán un elemento y otro, irán variando
                tasksToOrder.sort((a, b) => {
                    // mandamos las tareas completadas al final con return 1 comparándolas con el resto
                    if (a.completed && !b.completed) {
                        return 1;
                    }
                    // mandamos las tareas NO completadas al principio con return -1 comparándolas con el resto
                    if (!a.completed && b.completed) {
                        return -1;
                    }
                    // En cualquier otro caso, no cambia el orden relativo
                    return 0;
                });
                // pintamos las tareas una vez estén ordenadas
                printTasks(tasksToOrder);
            }

            // seleccionar el botón de añadir nueva tarea
            const button = document.querySelector(".new > button");

            // función añadir tarea, la cual se ejecuta cuando el usuario hace click en el botón
            const addTask = () => {
                // recogemos el input, puesto que queremos el valor que el usuario haya introducido en el
                const input = document.querySelector(".new > input");
                // creamos la estructura que tienen TODAS nuestras tareas, ya que deberá ser igual, por defecto la creamos NO completada
                const newTask = {
                    description: input.value, // input.value es el valor del input que ha escrito el usuario, el cual usamos en la propiedad description
                    completed: false
                };
                // añadimos la nueva tarea al principio de nuestro array con el método unshift
                tasks.unshift(newTask);
                // limpiamos el input
                input.value = "";
                // llamamos de nuevo a la función pintar para que nos pinte todas las tareas de nuevo ya que hemos añadida una nueva
                printTasks(tasks);
            }

            // añadir el evento click al botón para ejecutar la función addTask cuando esta es ejecutada
            button.addEventListener("click", addTask);

            // ejecutar la función ordenar tareas pasándole las tareas iniciales para un primer pintado de las mismas al abrir la aplicación
            orderTasks(tasks);
        </code></pre>
    </div>
</section>
